# 8. 開発ロードマップ

## 8.1 フェーズ概要

| フェーズ | 内容 | 期間 |
|---------|------|------|
| Phase 1 | 基盤構築・認証・基本画面 | 4週間 |
| Phase 2 | HeyGenアバター・音声認識・学習計画 | 5週間 |
| Phase 3 | 評価機能・管理者画面・外部連携 | 4週間 |
| Phase 4 | テスト・本番リリース準備 | 3週間 |

**合計: 16週間（約4ヶ月）**

### ガントチャート

![開発スケジュール ガントチャート](./images/開発スケジュール_ガントチャート.png)

---

## 8.2 Phase 1: 基盤構築（4週間 / 80人日）

### マイルストーン

| 週 | 目標 |
|----|------|
| Week 1 | 開発環境構築、DB設計、CI/CD構築 |
| Week 2 | 認証基盤（SSO連携）、バックエンドAPI基本実装 |
| Week 3 | フロントエンド基本画面実装（7画面） |
| Week 4 | 結合テスト、バグ修正 |

### タスク詳細

**インフラ・環境構築**
- [ ] 開発環境Docker化
- [ ] AWSリソース構築（EC2, RDS, S3, ElastiCache）
- [ ] CI/CDパイプライン構築（GitHub Actions）
- [ ] PostgreSQLスキーマ作成（11_データベーススキーマ参照）
- [ ] Supabase環境構築・認証設定

**認証基盤**
- [ ] mintoku work SSO連携（OAuth 2.0 / OpenID Connect）
- [ ] JWT認証実装
- [ ] セキュリティ設定（HTTPS、CORS、CSP）
- [ ] SSOコールバックAPI実装

**バックエンドAPI**
- [ ] FastAPIプロジェクト初期設定
- [ ] 認証API（SSO連携、トークンリフレッシュ、ログアウト）
- [ ] セッションAPI（開始、取得、回答送信、完了）
- [ ] スクリプトAPI（一覧取得、詳細取得）
- [ ] 質問管理API（CRUD、検索、インポート/エクスポート）
- [ ] 全データベースモデル実装（User, Session, Evaluation, WeakPoint等）
- [ ] シードデータ投入（60問の質問バンク、7業界マスタ）

**フロントエンド（ユーザー向け7画面）**
- [ ] Next.js プロジェクト初期設定
- [ ] SSOログイン画面（フォールバック用）
- [ ] ホーム画面（ダッシュボード、ナビゲーション）
- [ ] 練習モード選択画面
- [ ] 面接練習画面（テキストベース版）
- [ ] フィードバック画面（スコア表示、改善ポイント）
- [ ] 学習進捗画面（グラフ、苦手項目）
- [ ] 設定画面
- [ ] ボトムナビゲーション
- [ ] レスポンシブ対応（モバイル優先）

**管理画面**
- [ ] 質問管理（CRUD、検索、フィルタ）
- [ ] CSVインポート/エクスポート
- [ ] ユーザー分析画面（簡易版）

**学習計画機能（12.10節対応）**
- [ ] 学習ステップテンプレートJSON作成（learning_step_templates.json）
- [ ] 学習計画モデル実装（LearningPlan, LearningStep）
- [ ] 認証時の業界連携・学習計画生成ロジック
- [ ] 学習計画API（取得、ステップ完了更新）

**テスト（Phase 1）**
- [ ] ユニットテスト（バックエンド）
- [ ] ユニットテスト（フロントエンド）
- [ ] 結合テスト（API + 画面）

---

## 8.3 Phase 2: HeyGenアバター・音声認識統合（5週間 / 100人日）

### マイルストーン

| 週 | 目標 |
|----|------|
| Week 5 | HeyGen SDK統合、アバター表示 |
| Week 6 | Google STT統合、リアルタイム文字起こし |
| Week 7 | 面接フロー完成（質問→回答ループ） |
| Week 8 | 学習計画機能、チャレンジ機能 |
| Week 9 | エラーハンドリング、UI/UX改善、統合テスト |

### タスク詳細

**HeyGen Streaming Avatar統合**
- [ ] HeyGen Streaming Avatar SDK導入
- [ ] WebRTCセッション管理
- [ ] アバター発話制御（TaskType.REPEAT）
- [ ] 発話完了イベントハンドリング
- [ ] フォールバック処理（テキストモードへの切替）
- [ ] D-ID代替アバター対応
- [ ] JLPTレベル別話速調整（JLPT_VOICE_RATE）（12.2節参照）

**Google Cloud STT統合**
- [ ] Google Cloud STT設定・認証
- [ ] WebSocket音声ストリーミング
- [ ] リアルタイム文字起こし表示
- [ ] 無音検出・自動停止（5秒）
- [ ] テキスト入力フォールバック

**面接フロー制御**
- [ ] 質問→回答ループ実装
- [ ] スキップ機能
- [ ] セッション状態管理（進行中、完了、中断）
- [ ] 接続ステータス表示（接続中/接続処理中/未接続）
- [ ] 面接状態マシン（useInterviewStateMachine）
- [ ] フォローアップ質問管理

**チャレンジ機能（6.2.3節、12.9.3節対応）**
- [ ] チャレンジ選択画面UI実装
- [ ] チャレンジ種別設定フロー
- [ ] LocalStorageチャレンジ状態管理・復旧ロジック（12.9.7節）

**エラーハンドリング**
- [ ] アバター接続失敗時のリトライ・フォールバック
- [ ] マイク許可なし時の誘導ダイアログ
- [ ] 音声認識失敗時のテキスト入力切替
- [ ] ネットワーク切断時の再接続試行

**テスト（Phase 2）**
- [ ] ユニットテスト（新機能）
- [ ] 統合テスト（HeyGen + STT + 面接フロー）
- [ ] ブラウザ互換性テスト

---

## 8.4 Phase 3: 評価機能・苦手分析・外部連携（4週間 / 80人日）

### マイルストーン

| 週 | 目標 |
|----|------|
| Week 10 | GPT-4o評価ロジック実装（日本語能力・採用適性） |
| Week 11 | 苦手分析機能、学習進捗画面連携 |
| Week 12 | 管理者向け画面（8画面）、mintoku work連携 |
| Week 13 | 企業向けレポート、E2Eテスト |

### タスク詳細

**GPT-4o評価機能**
- [ ] 評価モデル定義（Evaluation, EvaluationResult）
- [ ] 評価API実装（GPT-4o実連携）
- [ ] 日本語能力評価スキーマ（語彙・文法・内容・敬語）
- [ ] 採用適性評価スキーマ（適応力・コミュニケーション力・主体性・定着意向・協調性）
- [ ] JLPTレベル別重み付け定義
- [ ] フィードバック生成ロジック
- [ ] JLPTレベル乖離検出（7.9節参照）
- [ ] 評価結果DB保存

**適応型JLPTレベル調整（7.10節、12.9節対応）**
- [ ] セッション中レベル自動調整ロジック
- [ ] レベル乖離検出後の質問難易度変更
- [ ] JLPTレベル推奨API

**苦手分析機能**
- [ ] 苦手項目検出アルゴリズム定義（閾値70点未満）
- [ ] 優先度計算定義（発生頻度 × 直近発生日）
- [ ] 苦手タグの蓄積ロジック（3回以上で記録）
- [ ] 解消条件判定定義（3回連続80点以上）
- [ ] 学習進捗画面への完全反映
- [ ] WeakPointモデル実装

**企業向け統合評価レポート（7.11節対応）**
- [ ] 評価レポート生成API
- [ ] レポートPDF/Excel出力
- [ ] バッチ集計ロジック

**管理者向け詳細分析画面（6.3.5-6.3.6節対応）**
- [ ] 管理者ログイン画面
- [ ] ダッシュボード（統計サマリー）
- [ ] 面接結果一覧画面
- [ ] 結果詳細画面
- [ ] 質問管理画面
- [ ] 質問編集画面
- [ ] ユーザー一覧画面
- [ ] ユーザー詳細分析画面（苦手項目・練習履歴）

**mintoku work連携**
- [ ] 連携フィールド定義（mintoku_synced, mintoku_synced_at）
- [ ] OAuth2 Client Credentials実装
- [ ] 結果送信API呼び出し（練習完了時）
- [ ] リトライ処理（指数バックオフ、最大3回）
- [ ] 同期ステータス管理
- [ ] エラーハンドリング・ログ記録

**テスト（Phase 3）**
- [ ] ユニットテスト（評価ロジック）
- [ ] 統合テスト（評価 + mintoku連携）
- [ ] E2Eテスト（全フロー通し）

---

## 8.5 Phase 4: テスト・本番リリース準備（3週間 / 60人日）

### マイルストーン

| 週 | 目標 |
|----|------|
| Week 14 | セキュリティテスト、負荷テスト |
| Week 15 | 本番環境構築、監視設定 |
| Week 16 | 最終テスト、ドキュメント整備、リリース |

### タスク詳細

**セキュリティテスト**
- [ ] OWASP Top 10脆弱性チェック
- [ ] 認証・認可テスト
- [ ] 入力バリデーションテスト
- [ ] セキュリティ監査レポート作成

**負荷テスト**
- [ ] 同時100ユーザー目標
- [ ] HeyGen/STT同時接続テスト
- [ ] API応答時間測定
- [ ] ボトルネック特定・改善

**本番環境構築**
- [ ] 本番AWSリソース構築
- [ ] SSL証明書設定
- [ ] CloudWatch監視設定
- [ ] バックアップ設定
- [ ] アラート設定

**運用準備**
- [ ] 運用マニュアル作成
- [ ] 障害対応手順書
- [ ] ドキュメント整備
- [ ] リリースチェックリスト

**最終テスト**
- [ ] 本番環境での動作確認
- [ ] ユーザー受け入れテスト（UAT）
- [ ] 最終バグ修正

---

## 8.6 テスト戦略

### テスト種別と実施タイミング

| テスト種別 | 説明 | 実施フェーズ |
|-----------|------|-------------|
| ユニットテスト | 関数・コンポーネント単位 | Phase 1-3（継続的） |
| 結合テスト | API + 画面連携 | Phase 1 |
| 統合テスト | 外部サービス連携 | Phase 2-3 |
| E2Eテスト | 全フロー通し | Phase 3 |
| セキュリティテスト | 脆弱性診断 | Phase 4 |
| 負荷テスト | 同時接続・性能 | Phase 4 |
| UAT | ユーザー受け入れ | Phase 4 |

### テストカバレッジ目標

| 対象 | 目標カバレッジ |
|------|---------------|
| バックエンドAPI | 80%以上 |
| フロントエンドコンポーネント | 70%以上 |
| 評価ロジック | 90%以上 |

---

## 8.7 依存関係図

```
Phase 1（Week 1-4）
├── インフラ基盤
│   └── 認証基盤
│       └── バックエンドAPI
│           └── フロントエンド基本画面（7画面）
├── 学習計画機能
│   └── 学習ステップテンプレート
│       └── 学習計画API・モデル

Phase 2（Week 5-9）
├── HeyGen統合
│   ├── 話速調整
│   └── 面接フロー
├── Google STT統合
│   └── 面接フロー（音声）
├── チャレンジ機能

Phase 3（Week 10-13）
├── GPT-4o評価
│   ├── 評価モデル
│   └── 評価ロジック
├── 苦手分析
│   ├── モデル
│   └── 完全統合
├── 適応型レベル調整
├── 企業向けレポート
├── 管理者画面（8画面）
├── mintoku work連携

Phase 4（Week 14-16）
├── セキュリティテスト
├── 負荷テスト
├── 本番環境構築
└── リリース
```

---

## 8.8 リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| HeyGen API制限 | アバター表示不可 | テキストモードフォールバック実装 |
| STT精度不足 | 評価精度低下 | テキスト入力オプション追加 |
| GPT-4oコスト超過 | 運用費増大 | バッチ処理、キャッシュ活用 |
| mintoku work API仕様変更 | 連携失敗 | API バージョニング、互換層 |
| 開発遅延 | リリース遅延 | 週次進捗確認、バッファ期間確保 |
| セキュリティ脆弱性 | サービス停止 | Phase 4でのセキュリティ監査 |

---

## 改訂履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025-01-30 | 1.0 | 初版作成 |
| 2026-02-01 | 2.0 | 全面改訂：タスクベースでフェーズ再構成、テスト戦略追加 |
| 2026-02-05 | 3.0 | 全面改訂：16週間スケジュールに更新（Phase 2: 5週間、Phase 3: 4週間）、工数見積v2.0と整合、状態列を削除 |
