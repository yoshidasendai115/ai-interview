# 6. 画面設計

## 6.1 画面一覧

### 6.1.1 外国人ユーザー向け画面（レスポンシブ対応）

| No | 画面名 | 説明 |
|----|--------|------|
| 1 | SSOログイン | フォールバック用認証画面（直接アクセス時のみ表示） |
| 2 | ホーム | メインダッシュボード、各機能へのナビゲーション |
| 3 | 練習モード選択 | 学習計画モード/自由練習モードの選択 |
| 4 | 面接練習 | AIアバターとの面接練習画面 |
| 5 | フィードバック | 練習結果の詳細評価表示 |
| 6 | 学習進捗 | スコア推移、苦手項目の確認 |
| 7 | 設定 | 表示言語、通知設定、ログアウト |

### 6.1.2 管理者向け画面

| No | 画面名 | 説明 |
|----|--------|------|
| 1 | 管理者ログイン | 管理者認証画面 |
| 2 | ダッシュボード | KPI表示、アクティビティ監視 |
| 3 | AI面接結果一覧 | ユーザーの面接練習結果・スコアの確認 |
| 4 | 質問管理 | 面接質問の登録・編集 |
| 5 | AI面談実施ユーザー一覧 | AI面談を実施したユーザーの一覧・検索 |
| 6 | ユーザー詳細分析 | 個別ユーザーの詳細分析・成長曲線 |

### 6.1.3 画面遷移図（ユーザー向け）

![ユーザー向け画面遷移図](./images/画面遷移図_ユーザー向け.png)

### 6.1.4 画面遷移図（管理者向け）

![管理者向け画面遷移図](./images/画面遷移図_管理者向け.png)

---

## 6.2 外国人ユーザー向け画面

### 6.2.1 SSOログイン画面（フォールバック用）

![SSOログイン画面](./images/画面設計書_2.1_SSOログイン.png)

> **注意**: この画面は直接アクセス時のフォールバック用です。
> 通常フロー（外部システムからのリンク経由）ではこの画面は表示されません。

#### 表示条件

| 条件 | この画面の表示 |
|------|---------------|
| 外部システムからリンク経由でアクセス | **表示されない**（直接ホームへ） |
| ブラウザで直接URLアクセス/ブックマーク | 表示される |
| アプリ直接起動（トークン期限切れ） | 表示される |
| セッション切れ後の再認証 | 表示される |

#### 画面要素

| 要素 | 説明 |
|------|------|
| アプリロゴ | 青い円形アイコン + 「AI Interview」タイトル |
| ようこそメッセージ | ログイン案内テキスト |
| SSOログインボタン | 「mintoku workでログイン」青いCTA |
| 案内テキスト | 初回ログイン時の自動登録説明 |
| 言語セレクター | 表示言語の変更（日本語/英語/他） |

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| アクセントカラー | #1565C0（青） |
| ボタン角丸 | 8px |
| カード背景 | #FFFFFF（白） |
| 画面背景 | #F5F5F5（薄いグレー） |

#### フォールバック認証フロー

```
直接アクセス → ログイン画面 → SSOボタン → 外部IdP → 認証 → ホーム画面
```

#### 備考

- **通常はこの画面を経由しない**（外部システムからシームレス遷移）
- 直接アクセス時のみ表示されるフォールバック画面
- 初回ログイン時に自動でユーザー登録
- メールアドレス/パスワードの直接入力は不要

---

### 6.2.2 ホーム画面

![ホーム画面](./images/画面設計書_2.2_ホーム.png)

#### 画面要素

| 要素 | 説明 | データなし時の表示 |
|------|------|-----------------|
| ヘッダー | 「マイダッシュボード」タイトル、プロフィールアイコン | - |
| 学習計画進捗カード | 業界別学習計画に対する進捗表示（下記詳細参照） | 初回設定誘導（下記「初回ユーザー向け表示」参照） |
| 面接練習を始めるボタン | 緑色のメインCTA、練習開始 | - |
| 今週の練習時間 | 学習時間表示（45分）、前週との比較、週間推移グラフ | 「0分」表示、グラフ非表示 |
| メニューカード | 学習進捗（※過去の結果含む）、ヘルプ、設定（各カードにサブタイトル付き） | - |
| ボトムナビゲーション | ホーム、練習、進捗、設定 | - |

#### 学習計画進捗カード（詳細）

学習計画に対する進捗を表示するメインカード。業界名とプログレスバーを含む。

##### カード構成

| 要素 | データソース | 計算ロジック |
|------|-------------|-------------|
| 学習計画名 | learning_plans.industry_id → industries.name | 業界名 + 「マスターコース」（例: 「建設業界マスターコース」） |
| プログレスバー | learning_steps | 完了ステップ数 / 全ステップ数 × 100 |
| 現在のステップ | learning_steps | `WHERE learning_plan_id = active_plan AND status = 'in_progress'` |
| ステップ説明 | learning_steps | ステップ番号 + ステップタイプ + JLPTレベル |
| 残りセッション | learning_steps | `required_sessions - completed_sessions` |

##### 表示例

![学習計画進捗カード](./images/画面設計書_2.2_学習計画進捗カード.png)

##### 状態別表示

| 状態 | 表示内容 |
|------|---------|
| 学習計画あり | 進捗バー + 現在ステップ情報 |
| 学習計画完了 | 完了バッジ + 「おめでとうございます！」+ 次のコース提案 |

※ 学習計画は認証時に同期生成されるため「生成中」状態は発生しない
※ API連携エラー時はシステム共通のエラー表示を使用

#### 初回ユーザー向け表示

| 状態 | 表示内容 |
|------|---------|
| 練習履歴なし | ウェルカムカード + 「最初の面接練習を始めましょう」CTA |
| 業界未設定 | 「希望業界に合わせた学習計画を作成します」+ mintoku workへのリンク |

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| 進捗カード背景色 | #1565C0（青） |
| プログレスバー背景 | rgba(255, 255, 255, 0.3) |
| プログレスバー前景 | #FFFFFF（白） |
| CTAボタン背景色 | #4CAF50（緑） |
| カード角丸 | 8px |
| 統計数字フォントサイズ | 28px（太字） |
| 背景色 | #F5F5F5（薄いグレー） |

---

### 6.2.3 練習モード選択画面

面接練習開始前に表示されるモード選択画面。

![練習モード選択画面](./images/画面設計書_2.3.0_練習モード選択.png)

#### 画面概要

| 項目 | 内容 |
|------|------|
| 表示タイミング | ホーム画面の「面接練習を始める」ボタンタップ後 |
| 対象ユーザー | 全ユーザー |
| 用途 | 学習計画モード / 自由練習モードの選択 |

#### 画面要素

| 要素 | 表示条件 | 内容 |
|-----|---------|------|
| ヘッダー | 常時 | 戻るボタン（←）、「練習モードを選択」タイトル |
| 学習計画カード | 学習計画あり | 「学習計画を続ける」+ 進捗表示 + おすすめバッジ |
| 自由練習カード | 常時 | 「自由に練習する」+ 説明テキスト |

#### 学習計画カードの構成

| 要素 | 内容 |
|------|------|
| おすすめバッジ | 「おすすめ」（緑色バッジ） |
| タイトル | 「学習計画を続ける」 |
| 業界名 | 例: 「建設業界マスターコース」 |
| プログレスバー | 完了ステップ数 / 全ステップ数 |
| 現在のステップ | 「ステップ3: N4 実践練習」 |
| 残りセッション | 「あと2回で次のステップへ」 |

#### 自由練習カードの構成

| 要素 | 内容 |
|------|------|
| タイトル | 「自由に練習する」 |
| 説明 | 「好きなレベル・業界で自由に練習できます」 |
| サブテキスト | 「学習計画の進捗にはカウントされません」 |

#### モード選択フロー

```
1. 「面接練習を始める」タップ
   ↓
2. 練習モード選択画面を表示
   ↓
3. ユーザーがモードを選択
   ├─ 学習計画カード → チャレンジ選択画面（6.2.4）へ
   │   └─ セッション: learning_step_id = 現在のステップID, is_free_practice = false
   │
   └─ 自由練習カード → レベル・業界選択画面（6.2.3.1）へ
       └─ セッション: learning_step_id = NULL, is_free_practice = true
```

#### 学習計画がない場合の表示

学習計画が存在しない場合、学習計画カードは非表示となり、自由練習カードのみ表示される。

| 表示要素 | 内容 |
|---------|------|
| 案内メッセージ | 「学習計画を作成すると、効率的に練習できます」 |
| 自由練習カード | 通常通り表示 |
| mintoku workリンク | 「希望業界を設定して学習計画を作成」（オプション） |

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| 学習計画カード背景色 | #1565C0（青）+ 白文字 |
| 自由練習カード背景色 | #FFFFFF（白）+ グレー枠線 |
| おすすめバッジ色 | #4CAF50（緑） |
| カード角丸 | 12px |
| カード間余白 | 16px |

---

### 6.2.4 面接練習画面

> **全画面表示**
> 面接練習画面は没入型の体験を提供するため、全画面表示で動作する。
> ボトムナビゲーションは非表示となり、ヘッダーも最小限の構成となる。
> AIアバターは画面背景全体に大きく表示される。

#### 画面レイアウト

![面接練習画面](./images/画面設計書_2.3_面接練習_全画面.png)

| 要素 | 説明 |
|------|------|
| AIアバター | 画面背景全体に大きく表示（上半身） |
| ヘッダー（最小化・半透明） | 戻るボタン（←）、質問番号（Q 3/10）、接続ステータス（🟢🟡🔴） |
| 質問表示オーバーレイ | 半透明背景で質問テキストを下部に表示 |
| 回答エリアオーバーレイ | 画面下部にリアルタイム文字起こし表示 |
| マイクボタン | 中央下部に大きく配置（録音開始/停止） |

※ボトムナビゲーションは非表示（没入型UI）

#### チャレンジ選択画面（面接開始前）

面接開始前に表示されるレベル選択画面。

| 要素 | 説明 |
|------|------|
| 申告レベル表示 | 「あなたのレベル: N3」 |
| 通常練習ボタン | 「N3で練習を開始」（推奨・緑色CTA） |
| チャレンジボタン | 「N2にチャレンジ」（青色ボタン）- 1つ上のレベルに挑戦 |

##### チャレンジ選択画面のレイアウト

![チャレンジ選択画面](./images/画面設計書_2.3_チャレンジ選択.png)

#### 画面要素（詳細）

| 要素 | 説明 |
|------|------|
| ヘッダー | 戻るボタン（←）、タイトル「面接練習」、質問番号（Q 3/10） |
| 接続ステータス | アバターとの接続状態（🟢 接続中 / 🟡 接続中... / 🔴 未接続） |
| AIアバターエリア | HeyGen Streaming Avatarによる面接官表示 |
| 発話インジケーター | 面接官が話している間「🎙️ 話し中...」を表示 |
| 質問表示ボックス | 面接官が話した質問をテキストでも表示 |
| 回答エリア | Google STTによるリアルタイム文字起こし表示 |
| マイクボタン | 録音開始/停止（タップで切り替え） |
| スキップボタン | 現在の質問をスキップして次へ |
| 次の質問へボタン | 回答完了後、次の質問に進む |

#### AIアバター仕様（HeyGen）

| 項目 | 内容 |
|------|------|
| サービス | HeyGen Streaming Avatar |
| SDK | `@heygen/streaming-avatar` |
| アバター | Wayne（アジア系男性） |
| 発話方式 | TaskType.REPEAT（セリフ通り発話） |
| 通信 | WebRTC |

#### 接続ステータス

| ステータス | 表示 | 背景色 |
|-----------|------|--------|
| 接続中 | 🟢 面接官と接続中 | #d4edda（緑） |
| 接続処理中 | 🟡 接続中... | #fff3cd（黄） |
| 未接続 | 🔴 未接続 | #f8d7da（赤） |

#### 面接フロー

```
1. 画面表示 → HeyGenアバター接続開始
2. 接続完了 → 面接官が挨拶「こんにちは。本日は面接にお越しいただきありがとうございます。」
3. 質問読み上げ → アバターがリップシンクで質問を発話
4. ユーザー回答 → マイクボタンタップで録音開始
5. 音声認識 → Google STTでリアルタイム文字起こし
6. 回答完了 → 「次の質問へ」または自動で次へ
7. 全質問完了 → フィードバック画面へ遷移
```

#### チャレンジ機能

面接開始前に、申告レベルより1つ上のレベルで挑戦できる「チャレンジ」機能を提供。

| 要素 | 説明 |
|------|------|
| チャレンジボタン | 「N○にチャレンジ」- 1つ上のレベルで練習 |
| チャレンジ中表示 | 「チャレンジ中」バッジ |

##### チャレンジの条件

| 条件 | 詳細 |
|------|------|
| 対象レベル | N5〜N2（N1は対象外・最高レベルのため） |
| 回数制限 | **なし**（何度でも挑戦可能） |

#### 機能仕様

| 機能 | 説明 |
|------|------|
| リップシンク | HeyGen Avatarが質問を口の動きと同期して読み上げ |
| リアルタイム文字起こし | Google Cloud STTで音声をリアルタイムにテキスト化 |
| 録音インジケーター | 録音中はマイクアイコンがアニメーション |
| 自動停止 | 5秒間の無音で録音自動停止 |
| スキップ | 質問をスキップ可能（スコアには影響） |

#### エラーハンドリング

| エラー | 対応 |
|--------|------|
| アバター接続失敗 | 再接続ボタン表示、3回失敗でテキストのみモードに切替 |
| マイク許可なし | 設定画面への誘導ダイアログ表示 |
| 音声認識失敗 | テキスト入力フォールバック表示 |
| ネットワーク切断 | 自動再接続試行、失敗時は中断確認ダイアログ |

#### エラーハンドリング詳細

##### リトライ戦略（指数バックオフ）

| 試行回数 | 待機時間 | 累計時間 |
|---------|---------|---------|
| 1回目 | 即時 | 0秒 |
| 2回目 | 1秒 | 1秒 |
| 3回目 | 2秒 | 3秒 |
| 4回目（最終） | 4秒 | 7秒 |

```
待機時間 = min(2^(試行回数-1), 最大待機時間) 秒
最大待機時間 = 4秒
最大試行回数 = 4回
```

##### エラー時のUI状態遷移

![エラーハンドリング状態遷移図](./images/エラーハンドリング_状態遷移図.png)

##### フォールバックモード一覧

| エラー種別 | フォールバックモード | ユーザー体験 |
|-----------|---------------------|-------------|
| HeyGen接続失敗 | テキストのみモード | 質問がテキストで表示、アバター非表示 |
| STT接続失敗 | テキスト入力モード | マイクボタンがテキスト入力欄に変更 |
| ネットワーク不安定 | オフライン待機モード | 回答を一時保存、接続復旧後に自動送信 |
| セッションタイムアウト | セッション再開モード | 途中結果を保存、後から再開可能 |

##### フォールバックモード切替時のUI

| モード | 表示内容 | ユーザーアクション |
|--------|---------|------------------|
| テキストのみモード | 「アバター接続に問題が発生しました。テキストモードで続行します。」 | そのまま続行 / 再接続を試す |
| テキスト入力モード | 「マイクが使用できません。回答をテキストで入力してください。」 | テキスト入力欄に回答を入力 |
| オフライン待機モード | 「ネットワーク接続を確認中です...」+ スピナー | 待機 / セッションを中断して保存 |
| セッション再開モード | 「前回のセッションが中断されています。続きから再開しますか？」 | 再開する / 最初からやり直す |

---

### 6.2.5 フィードバック画面

![フィードバック画面](./images/画面設計書_2.4_フィードバック.png)

> **評価体系について**
> フィードバック画面では、日本語能力評価（07_評価ロジック）と採用適性評価（13_面接シナリオ設計）の両方を表示する。

#### 画面要素

| 要素 | 説明 | データなし/エラー時の表示 |
|------|------|------------------------|
| ヘッダー | 戻るボタン（←）、「練習結果」タイトル | - |
| 総合スコアカード | 青いカードに白文字で大きくスコア表示（78/100点）、学習促進メッセージを2行で表示 | 評価中: スピナー + 「評価中です...」 |
| 日本語能力評価カード | 語彙、文法、内容、敬語の各スコア（0-100点）をプログレスバーで表示 | 評価中: スケルトンUI |
| 採用適性評価カード | 適応力、コミュニケーション力、主体性、定着意向、協調性の各スコア（1-5点）を星評価で表示 | 評価中: スケルトンUI |
| 改善ポイントカード | AIが特定した弱点と改善提案 | 弱点なし: 「改善ポイントはありません」 |
| ボトムナビゲーション | ホーム、練習、進捗、設定 | - |

#### 評価処理状態の表示

| 状態 | 表示 | 自動更新 |
|------|------|---------|
| 評価処理中 | スピナー + 「評価中です...（約30秒）」（下図参照） | 5秒ごとにポーリング |
| 評価完了 | 通常のフィードバック画面 | - |
| 評価失敗 | エラーモーダル表示（下図参照） | - |

#### 評価処理中のUI

![評価処理中画面](./images/画面設計書_6.7.1_評価処理中.png)

#### 評価失敗時のUI

![評価処理失敗モーダル](./images/画面設計書_6.7.3_評価処理失敗モーダル.png)

#### 評価表示レイアウト

![フィードバック画面レイアウト](./images/評価_フィードバック画面レイアウト.png)

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| スコアカード背景色 | #1565C0（青） |
| プログレスバー背景 | #E3F2FD（薄い青） |
| 星評価アクティブ色 | #FFC107（金） |
| 星評価非アクティブ色 | #E0E0E0（グレー） |
| カード角丸 | 8px |
| 数字フォントサイズ | 48px（スコア） |

#### スコア表示ルール（日本語能力評価）

| スコア範囲 | 色 | カラーコード |
|-----------|-----|------------|
| 80-100 | 青 | #1565C0 |
| 60-79 | ライトブルー | #42A5F5 |
| 0-59 | 赤 | #EF5350 |

#### ユーザー向け学習促進メッセージ

> **注意**: 「採用を推奨」等の表現は管理者向けです。
> ユーザー向けフィードバック画面では、スコア範囲に基づいて以下の学習促進メッセージを表示します。

| スコア範囲 | ユーザー向けメッセージ |
|-----------|---------------------|
| 85-100点 | 面接準備は万全です！自信を持って臨みましょう |
| 70-84点 | 面接準備が十分です |
| 55-69点 | 良い調子です。さらに練習を続けましょう |
| 40-54点 | 基礎はできています。苦手項目を重点的に練習しましょう |
| 25-39点 | 練習を続けて自信をつけましょう |
| 0-24点 | 基礎から丁寧に練習していきましょう |

#### 適応型JLPTレベル調整ボタン

スコアに応じて次回面接のレベルを提案するボタンを表示します。
詳細なロジックは **07_評価ロジック 7.10節** を参照。

| スコア範囲 | 表示ボタン | メッセージ |
|-----------|----------|----------|
| 70点以上（N1以外） | 「N○にチャレンジ！」 | 「素晴らしい！N○にチャレンジしましょう！」 |
| 70点以上（N1） | 「N1で練習を続ける」 | 「最高レベル（N1）で優秀な成績です！」 |
| 31〜69点 | 「同じレベルで再挑戦」＋「上のレベルにチャレンジ」 | 「もう少し練習しましょう。」 |
| 30点以下（N5以外） | 「N○で練習する」 | 「基礎から練習しましょう。」 |
| 30点以下（N5） | 「N5で練習を続ける」 | 「N5で基礎を固めましょう。」 |

#### 平均スコア表示（複数回受験時）

同一レベルで複数回受験した場合、以下の統計情報を表示します。

| 表示項目 | 説明 |
|---------|------|
| 最終評価（平均） | 同一レベルでの全セッションの平均スコア |
| 受験回数 | 同一レベルでのセッション数 |
| 最高点 | 同一レベルでの最高スコア |
| 最低点 | 同一レベルでの最低スコア |

#### 企業向け統合評価レポートについて

> **注意**: 企業向け統合評価レポート（推定実力レベル、レベル別パフォーマンス、業務適性判定など）は**ユーザー向け画面には表示しません**。
> これらの情報は **6.5.6節「評価結果のmintoku work連携」** でAPI経由でmintoku workに送信され、企業側でのみ閲覧可能です。
>
> ユーザー向けフィードバック画面で表示する情報は以下のみです：
> - 総合スコア・学習促進メッセージ
> - 日本語能力評価（4カテゴリ）
> - 採用適性評価（5軸）
> - 改善ポイント
> - レベル調整ボタン

---

### 6.2.6 学習進捗画面

![学習進捗画面](./images/画面設計書_2.5_学習進捗.png)

> **評価体系について**
> 学習進捗画面では、日本語能力評価（07_評価ロジック）と採用適性評価（13_面接シナリオ設計）の両方の推移を表示する。

#### 画面要素

| 要素 | 説明 | データなし時の表示 |
|------|------|-----------------|
| ヘッダー | 「学習進捗」タイトル | - |
| 統計カード | 青い2カードレイアウト（練習回数、総合平均スコア） | 「0回」「-」 |
| スコア推移カード | 過去30日間の総合スコア・日本語能力スコア・採用適性スコアの推移をグラフ表示 | 「データが不足しています」+ 空グラフ |
| 日本語能力サマリーカード | 語彙・文法・内容・敬語の平均スコアをレーダーチャートで表示 | 全軸0の状態で表示 |
| 採用適性サマリーカード | 適応力・コミュニケーション力・主体性・定着意向・協調性の平均スコアを星評価で表示 | 全て未評価（グレー星） |
| 苦手項目カード | 優先度別（赤/オレンジ/黄）の日本語苦手項目と「練習する」ボタン（下記参照） | 「苦手項目はまだ検出されていません」 |
| ボトムナビゲーション | ホーム、練習、進捗、設定 | - |

#### 苦手項目を練習する機能

苦手項目カードの「練習する」ボタンをタップすると、該当する苦手カテゴリに関連する質問を優先的に出題する面接練習を開始する。

| 項目 | 内容 |
|------|------|
| 遷移先 | チャレンジ選択画面（6.2.4） |
| 質問選択ロジック | 苦手カテゴリ（敬語、文法など）に関連する質問を優先的に選択 |
| セッション種別 | 通常の面接練習と同じ（評価・記録も同様） |
| パラメータ | `focus_category` として苦手カテゴリIDを渡す |

#### 初回ユーザー向け表示

| 状態 | 表示内容 |
|------|---------|
| 練習履歴なし | 「練習を始めると、あなたの成長記録がここに表示されます」+ イラスト |

#### 学習進捗表示レイアウト

![学習進捗画面レイアウト](./images/評価_学習進捗画面レイアウト.png)

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| 統計カード背景色 | #1565C0（青） |
| 統計数字フォントサイズ | 28px（太字） |
| カード角丸 | 8px |
| 星評価アクティブ色 | #FFC107（金） |
| 星評価非アクティブ色 | #E0E0E0（グレー） |
| 苦手項目（高）背景 | #FFEBEE + #EF5350ドット |
| 苦手項目（中）背景 | #FFF3E0 + #FF9800ドット |
| 苦手項目（低）背景 | #FFFDE7 + #FDD835ドット |

#### グラフ表示

| 項目 | 表示内容 |
|------|---------|
| 総合スコア推移 | 日本語能力と採用適性を統合したスコア（0-100点） |
| 日本語能力推移 | 語彙・文法・内容・敬語の平均スコア（0-100点） |
| 採用適性推移 | 5つの評価軸の平均スコア（1-5点を0-100点にスケール） |

---

### 6.2.7 設定画面

![設定画面](./images/画面設計書_2.6_設定.png)

#### 画面要素

| 要素 | 説明 | 備考 |
|------|------|------|
| ヘッダー | 「設定」タイトル | - |
| ユーザー情報カード | 氏名、メールアドレス、所属組織を表示 | mintoku workから取得（編集不可） |
| 表示言語設定 | 日本語 / English / その他 | ドロップダウン選択 |
| 面接表示設定 | 面接官の発言テキスト表示ON/OFF | トグルスイッチ |
| アプリ情報 | バージョン、利用規約、プライバシーポリシー | リンク |
| ログアウトボタン | mintoku workからログアウト | 確認ダイアログ表示 |
| ボトムナビゲーション | ホーム、練習、進捗、設定、mintoku | 設定がアクティブ |

#### 表示言語設定

| 言語 | コード | 備考 |
|------|--------|------|
| 日本語 | ja | デフォルト |
| English | en | 英語 |
| 中文（简体） | zh-CN | 中国語（簡体字） |
| Tiếng Việt | vi | ベトナム語 |
| ภาษาไทย | th | タイ語 |
| Bahasa Indonesia | id | インドネシア語 |
| Filipino | fil | フィリピン語 |
| ភាសាខ្មែរ | km | クメール語（カンボジア） |
| မြန်မာဘာသာ | my | ミャンマー語 |
| ພາສາລາວ | lo | ラオス語 |
| Bahasa Melayu | ms | マレー語 |
| বাংলা | bn | ベンガル語（バングラデシュ） |
| नेपाली | ne | ネパール語 |

> **表示言語について**
> 選択した言語はLocalStorageに保存され、次回アクセス時に自動適用されます。
> 面接練習中のAIアバターの発話言語は日本語固定です（日本語学習目的のため）。

#### 面接表示設定

| 項目 | 説明 | デフォルト |
|------|------|----------|
| 面接官の発言テキスト表示 | AI面接官が話す内容（日本語）を画面にテキストで表示するかどうか | ON |

> **面接官発言テキストについて**
> - ONの場合：面接官（AIアバター）が話している内容が字幕のように画面に表示されます
> - OFFの場合：音声のみで発言内容は表示されません（リスニング練習向け）
> - 設定はLocalStorageに保存され、次回以降の面接に適用されます

#### ログアウト処理

![ログアウト確認ダイアログ](./images/画面設計書_2.6.1_ログアウト確認ダイアログ.png)

```
ログアウトボタンタップ
    ↓
確認ダイアログ「ログアウトしますか？」
    ↓ [はい]
ローカルトークン削除
    ↓
mintoku workへリダイレクト
```

**設計ノート:**
- リダイレクト先URLは環境変数（`MINTOKU_WORK_URL`）で設定可能
- mintoku workのセッションは維持される（SP-only logout）
- ユーザーが再度AI面接を使う場合はmintoku workからリンク経由でアクセス

#### デザイン仕様（mintoku study準拠）

| 項目 | 値 |
|------|------|
| カード背景色 | #FFFFFF（白） |
| セクション区切り | 1px #E0E0E0 |
| トグルスイッチON色 | #1565C0（青） |
| ログアウトボタン色 | #F44336（赤）テキストのみ |

---

## 6.3 管理者向け画面

### 6.3.1 管理者ログイン画面

![管理者ログイン画面](./images/画面設計書_3.0_管理者ログイン.png)

#### 画面要素

| 要素 | 説明 |
|------|------|
| アプリロゴ | 青い円形アイコン + 「AI Interview 管理画面」タイトル |
| メールアドレス入力 | 管理者メールアドレス |
| パスワード入力 | 管理者パスワード |
| ログインボタン | 認証実行 |

#### 認証方式

| 項目 | 内容 |
|------|------|
| 認証方式 | メールアドレス + パスワード |
| セッション管理 | JWT（有効期限: 8時間） |
| 二要素認証 | 将来実装予定 |

---

### 6.3.2 ダッシュボード画面

![ダッシュボード画面](./images/画面設計書_3.1_管理者ダッシュボード.png)

#### 画面要素

| 要素 | 説明 | データなし時の表示 |
|------|------|-----------------|
| ヘッダー | 「ダッシュボード」タイトル、ログアウトボタン | - |
| KPIカード | 総ユーザー数、今月の練習数、平均スコア、アクティブユーザー数 | 全て「0」表示 |
| スコア分布グラフ | 全ユーザーのスコア分布（棒グラフ） | 空グラフ |
| 最近の練習一覧 | 直近の練習セッション一覧（ユーザー名、スコア、日時） | 「練習履歴がありません」 |
| サイドナビゲーション | ダッシュボード、面接結果、質問管理、ユーザー分析 | - |

---

### 6.3.3 AI面接結果一覧画面

#### 画面要素

| 要素 | 説明 |
|------|------|
| 検索・フィルター | ユーザー名検索、期間指定、スコア範囲 |
| 結果一覧テーブル | ユーザー名、総合スコア、日本語能力、採用適性、実施日時 |
| 詳細ボタン | 個別結果の詳細画面へ遷移 |
| エクスポートボタン | CSV/JSON形式でダウンロード |

#### 結果詳細画面

| 要素 | 説明 |
|------|------|
| ユーザー情報 | 氏名、所属、JLPTレベル |
| 総合評価 | 総合スコア、推奨アクション |
| 日本語能力評価 | 語彙・文法・内容・敬語の各スコアとフィードバック |
| 採用適性評価 | 5軸の評価スコアと詳細コメント |
| 回答履歴 | 各質問への回答内容と個別評価 |

#### 練習内容確認機能（拡張）

管理者が各ユーザーの練習内容を詳細に確認できる機能。

##### タブ構成

| タブ | 内容 |
|------|------|
| 概要 | 総合評価・推奨アクション |
| セッション履歴 | 時系列順のセッション一覧（古い順） |
| 質問・回答詳細 | 各質問とユーザーの回答内容 |
| 企業向けレポート | 統合評価レポートの全項目表示 |

##### セッション履歴タブ

| 表示項目 | 説明 |
|---------|------|
| セッションID | 一意のセッション識別子 |
| 実施日時 | セッション開始日時 |
| JLPTレベル | 練習時のレベル |
| チャレンジ有無 | チャレンジ枠での挑戦かどうか |
| 総合スコア | そのセッションの総合スコア |
| 所要時間 | セッションの所要時間（秒） |

##### 質問・回答詳細タブ

| 表示項目 | 説明 |
|---------|------|
| 質問番号 | Q1, Q2, Q3... |
| 質問テキスト | 面接官が発話した質問内容 |
| 回答テキスト | ユーザーの回答内容（音声認識結果） |
| 個別スコア | 語彙・文法・内容・敬語の4カテゴリスコア |
| 個別フィードバック | 各カテゴリの改善点 |
| フォローアップ有無 | 深掘り質問が発生したかどうか |

##### 企業向けレポートタブ

| 表示項目 | 説明 |
|---------|------|
| 推定実力レベル | 申告レベルと推定レベルの比較 |
| 判定根拠 | 推定の根拠となる説明 |
| レベル別パフォーマンス | 全レベルの成績一覧 |
| 業務適性判定 | 4段階の業務適性 |
| 詳細スコア | 4カテゴリの平均スコア |
| 苦手項目 | 改善が必要な項目一覧 |

##### データエクスポート機能

| 形式 | 内容 |
|------|------|
| CSV | 基本的な評価データ（スコア、日時） |
| JSON | 全データ（セッション履歴、企業向けレポート含む） |

---

### 6.3.4 質問管理画面

![質問管理画面](./images/画面設計書_3.2_質問管理.png)

#### 画面要素

| 要素 | 説明 |
|------|------|
| 質問一覧 | 業界別・JLPTレベル別の質問一覧 |
| 新規作成ボタン | 新しい質問の作成 |
| 編集ボタン | 既存質問の編集画面へ遷移 |
| 削除ボタン | 質問の削除（確認モーダル表示） |
| プレビューボタン | 質問のプレビュー表示 |

#### 質問編集画面

![質問編集画面](./images/画面設計書_3.2.1_質問編集.png)

| 要素 | 説明 |
|------|------|
| 基本情報 | 質問セット名、業界、JLPTレベル、所要時間 |
| 質問リスト | ドラッグ&ドロップで並べ替え可能な質問一覧 |
| 質問追加 | 質問バンクからの選択または新規作成 |
| 評価基準設定 | 各質問の評価ポイント設定 |
| 保存ボタン | 変更内容を保存して一覧に戻る |
| キャンセルボタン | 変更を破棄して一覧に戻る |

#### 削除確認モーダル

![削除確認モーダル](./images/画面設計書_3.2.2_削除確認モーダル.png)

| 要素 | 説明 |
|------|------|
| 警告メッセージ | 削除対象の質問セット名と注意事項を表示 |
| 削除ボタン | 質問を削除（論理削除） |
| キャンセルボタン | モーダルを閉じて一覧に戻る |

> **注意**: 質問の削除は論理削除（`is_deleted`フラグ）で行い、データベースからは物理削除しない。

---

### 6.3.5 AI面談実施ユーザー一覧画面

![AI面談実施ユーザー一覧画面](./images/画面設計書_3.3_ユーザー分析.png)

#### 画面概要

| 項目 | 内容 |
|------|------|
| 実装場所 | 本システム 管理者画面 |
| 対象ユーザー | 管理者 |
| 用途 | AI面談を実施したユーザーの一覧表示・検索・詳細画面への遷移 |

> **注意**: 本システムはmintoku workの全ユーザー一覧は保持しません。
> mintoku workから本システムに遷移し、AI面談を実施したユーザーの情報のみを管理します。

#### 検索・フィルタ機能

| 要素 | 説明 |
|------|------|
| キーワード検索 | ユーザー名・メールアドレスで検索 |
| JLPTレベルフィルタ | N1〜N5で絞り込み |
| 採用推奨度フィルタ | 強く推奨 / 推奨 / 条件付き推奨 / 要検討 |
| 期間フィルタ | 最終面談日の期間指定 |
| 並び替え | 最終面談日 / 平均スコア / 練習回数 |

#### 一覧表示項目

| 列 | 説明 |
|----|------|
| ユーザー名 | mintoku workから取得した氏名 |
| JLPTレベル | 申告レベル（N1〜N5） |
| 練習回数 | AI面談の実施回数 |
| 平均スコア | 全セッションの平均総合スコア |
| 採用推奨度 | 最新の採用推奨度バッジ |
| 最終面談日 | 最後にAI面談を実施した日時 |
| 詳細ボタン | ユーザー詳細分析画面（6.3.6）へ遷移 |

#### 空状態の表示

| 状態 | 表示内容 |
|------|---------|
| ユーザーなし | 「AI面談を実施したユーザーはいません」 |

#### 一覧のアクション

| アクション | 説明 |
|-----------|------|
| 詳細表示 | 選択したユーザーの詳細分析画面へ遷移 |
| CSV出力 | 一覧データのエクスポート |
| 一括レポート | 選択したユーザーのレポートを一括生成 |

---

### 6.3.6 ユーザー詳細分析画面

![ユーザー詳細分析画面](./images/画面設計書_3.5_ユーザー詳細分析.png)

#### 画面概要

| 項目 | 内容 |
|------|------|
| 実装場所 | 本システム 管理者画面 |
| 対象ユーザー | 管理者 |
| 用途 | 個別ユーザーの日本語能力・採用適性・成長状況の確認 |

#### 基本情報

| 要素 | 説明 |
|------|------|
| プロフィールカード | 氏名、所属、JLPTレベル、登録日 |
| サマリーカード | 練習回数、平均スコア、推定実力レベル、最終練習日、業務適性、採用推奨度 |

#### 表示セクション

| セクション | 内容 |
|-----------|------|
| 日本語能力評価 | 語彙・文法・内容・敬語の詳細スコア |
| 採用適性評価 | 適応力・コミュニケーション力・主体性・定着意向・協調性 |
| レベル別パフォーマンス | 申告レベル・チャレンジレベルでの成績 |
| 業務適性判定 | 基本接客〜高度業務の4段階判定バッジ |
| 総合コメント | 強み・課題・推奨配属の自動生成コメント |

#### タブ切り替えコンテンツ

| タブ | 内容 | データなし時の表示 |
|-----|------|-----------------|
| 成長曲線 | スコア推移の折れ線グラフ（総合スコア・日本語能力・採用適性） | 「データが不足しています」+ 空グラフ |
| 苦手項目 | 優先度別（高・中・低）の苦手項目一覧（上位5件）、「すべて見る」リンク | 「検出された苦手項目はありません」 |
| 練習履歴 | 日付、質問セット、スコアの一覧（直近5件）、「すべて見る」リンク | 「練習履歴がありません」 |

#### 苦手項目詳細画面（すべての苦手項目）

![苦手項目詳細画面](./images/画面設計書_3.6.1_苦手項目詳細.png)

> 苦手項目タブの「すべて見る」リンクから遷移する画面

##### 画面概要

| 項目 | 内容 |
|------|------|
| 実装場所 | 本システム 管理者画面 |
| 対象ユーザー | 管理者 |
| 用途 | ユーザーの全苦手項目を詳細に確認・分析 |

##### フィルタ・検索機能

| 要素 | 説明 |
|------|------|
| カテゴリフィルタ | 語彙 / 文法 / 内容 / 敬語 / 適性 |
| 優先度フィルタ | 高 / 中 / 低 |
| 期間フィルタ | 検出された期間の指定 |
| 並び替え | 優先度順 / 検出日順 / カテゴリ順 |

##### 一覧表示項目

| 列 | 説明 |
|----|------|
| 優先度バッジ | 高（赤）/ 中（黄）/ 低（青） |
| カテゴリ | 語彙・文法・内容・敬語・適性 |
| 苦手項目 | 具体的な苦手内容の説明 |
| 検出回数 | この苦手項目が検出された回数 |
| 初回検出日 | 最初に検出された日付 |
| 最終検出日 | 最後に検出された日付 |
| 改善状況 | 未改善 / 改善中 / 改善済み |

##### 改善状況の判定基準

| ステータス | 条件 |
|-----------|------|
| 未改善 | 直近3回のセッションで継続して検出 |
| 改善中 | 直近3回のうち1〜2回で検出 |
| 改善済み | 直近3回のセッションで未検出 |

##### アクション

| アクション | 説明 |
|-----------|------|
| 詳細表示 | 該当項目が検出されたセッション一覧を表示 |
| CSV出力 | 苦手項目一覧のエクスポート |
| 戻る | ユーザー詳細分析画面へ戻る |

#### 練習履歴詳細画面（すべての練習履歴）

![練習履歴詳細画面](./images/画面設計書_3.6.2_練習履歴詳細.png)

> 練習履歴タブの「すべて見る」リンクから遷移する画面

##### 画面概要

| 項目 | 内容 |
|------|------|
| 実装場所 | 本システム 管理者画面 |
| 対象ユーザー | 管理者 |
| 用途 | ユーザーの全練習履歴を詳細に確認・分析 |

##### サマリーカード

| 項目 | 説明 |
|------|------|
| 総練習回数 | AI面談の実施回数 |
| 平均スコア | 全セッションの平均総合スコア |
| チャレンジ成功率 | チャレンジ枠での合格率 |
| 総練習時間 | 累計練習時間 |

##### フィルタ・検索機能

| 要素 | 説明 |
|------|------|
| レベルフィルタ | N1〜N5、チャレンジ |
| 判定フィルタ | S / A / B / C / D |
| 期間フィルタ | 実施日の期間指定 |
| 並び替え | 日付順 / スコア順 / 所要時間順 |

##### 一覧表示項目

| 列 | 説明 |
|----|------|
| 実施日時 | セッションの実施日時 |
| レベル | N1〜N5（チャレンジは⚡マーク付き） |
| 質問セット | 使用した面接質問セット名 |
| 総合スコア | セッションの総合スコア |
| 日本語スコア | 日本語能力の評価スコア |
| 適性スコア | 採用適性の評価スコア |
| 判定 | S〜D の判定バッジ |
| 所要時間 | セッションの所要時間 |

##### アクション

| アクション | 説明 |
|-----------|------|
| 詳細 | セッションの詳細評価画面を表示 |
| 音声再生 | セッションの録音を再生 |
| レポート出力 | 個別セッションのレポートをPDF出力 |
| CSV出力 | 履歴一覧のエクスポート |
| 戻る | ユーザー詳細分析画面へ戻る |

---

### 6.3.7 mintoku workへの評価結果連携

練習完了時に評価結果をmintoku workのAPIに送信します。

> **API仕様の詳細**
> 送信データ形式、フィールド定義、認証方式、エラー処理については **10_API仕様 10.6節** を参照してください。

---

## 6.4 画面遷移の説明

> 画面遷移図は6.1.3（ユーザー向け）および6.1.4（管理者向け）を参照。

### 6.4.1 フォールバックフロー（直接アクセス時）

直接アクセス/ブックマーク/アプリ起動時のみSSOログイン画面を経由する。

### 6.4.2 ユーザー向け画面遷移

ホーム画面を起点に各機能画面へ遷移。各画面からホームへ戻ることが可能。

### 6.4.3 管理者向け画面遷移

管理者ログイン画面からダッシュボードへ遷移し、サイドナビゲーションで各管理機能へアクセスする。
評価結果はmintoku workへAPI経由で自動送信される。

### 6.4.4 対応プラットフォーム

同一のReact Webアプリケーションをブラウザ/iOS(WebView)/Android(WebView)で表示。

---

## 6.5 認証方式

### 6.5.1 mintoku work 連携概要

本システムと「**mintoku work**」の連携は以下の2点のみ：

| 連携種別 | 内容 |
|---------|------|
| SSO認証 | ユーザーはmintoku workから本システムにシームレス遷移（OAuth 2.0） |
| 評価結果連携 | 練習完了時に評価結果をmintoku workへAPI送信 |

> **注意**: 管理機能（ダッシュボード、質問管理、ユーザー分析等）は本システムで提供します。

![mintoku work連携フロー](./images/画面設計書_5.1_mintoku_work連携.png)

### 6.5.2 SSO（シングルサインオン）

| 項目 | 内容 |
|------|------|
| 認証方式 | OAuth 2.0 / OpenID Connect |
| IdP連携先 | **mintoku work** |
| ユーザー登録 | 初回SSO時に自動作成 |
| セッション管理 | JWT |
| 遷移方式 | シームレス遷移（ログイン画面スキップ） |

### 6.5.3 シームレス遷移フロー（推奨）

mintoku workからのリンククリックで直接ホーム画面へ遷移する方式。

```
1. ユーザーがmintoku workにログイン済み
2. mintoku work内の「AI面接練習」リンクをクリック
   - リンク例: https://ai-interview.example.com/auth/callback?token=xxx
3. 本アプリがトークンを検証
4. ユーザー情報取得、なければ自動登録
5. JWTを発行してセッション確立
6. ホーム画面に直接遷移（ログイン画面は表示されない）
```

#### mintoku work側の実装要件

| 項目 | 内容 |
|------|------|
| リンク生成 | 署名付きトークン（HMAC-SHA256）を含むURL生成 |
| トークン内容 | user_id, email, name, organization, jlpt_level, exp（有効期限） |
| 有効期限 | 発行から5分以内 |
| セキュリティ | HTTPS必須、トークンは1回使い切り |

### 6.5.4 フォールバックフロー（直接アクセス時）

ユーザーがブックマーク等から直接アクセスした場合のフロー。

```
1. ユーザーがログイン画面にアクセス
2. SSOログインボタンをクリック
3. mintoku workの認証画面にリダイレクト
4. ユーザーがmintoku workで認証
5. コールバックURLにリダイレクト（認証コード付き）
6. バックエンドでトークン交換
7. ユーザー情報取得、なければ自動登録
8. JWTを発行してフロントエンドに返却
9. ホーム画面に遷移
```

### 6.5.5 mintoku workから取得するユーザー情報

| 項目 | 必須 | 説明 |
|------|------|------|
| user_id | ○ | mintoku work側のユーザーID |
| メールアドレス | ○ | 一意識別子 |
| 氏名 | ○ | 表示名 |
| 所属組織 | ○ | 人材紹介会社/学校名 |
| JLPTレベル | △ | 未設定の場合は初回設定画面へ |
| 希望業界 | △ | 1つの希望業界（未設定の場合あり） |

> **希望業界について**
> - 希望業界が設定されている場合、その業界に基づいて学習計画を自動生成します
> - 希望業界が未設定の場合は汎用学習計画を生成します
> - 詳細なデータ形式は **10_API仕様 10.2節** を参照

### 6.5.6 評価結果のmintoku work連携

面接練習完了後、評価結果をmintoku workのAPIに送信します。

| 連携方向 | 内容 |
|---------|------|
| 本システム → mintoku work | 練習完了時に評価結果・学習進捗を送信 |
| mintoku work → 本システム | ユーザー情報更新時にWebhookで受信 |

> **API仕様の詳細**
> 送信データ形式、フィールド定義、Webhook仕様については **10_API仕様 10.6節** を参照してください。

### 6.5.7 mintoku work側でのデータ活用（スコープ外）

> **注意**: 本システムは10_API仕様 10.6節で定義したAPIデータをmintoku workへ送信します。
> mintoku work側での表示方法・画面実装は**本システムのスコープ外**です。

---

## 改訂履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025-01-30 | 1.0 | 初版作成 |
| 2025-01-30 | 1.1 | シームレス遷移対応、SSOログイン画面をフォールバック用に変更 |
| 2025-01-30 | 1.2 | 管理者ログイン画面追加、ブラウザ/アプリ両対応を明記 |
| 2025-01-30 | 1.3 | iOS/AndroidアプリをWebView方式に変更 |
| 2025-01-30 | 1.4 | mintoku work連携を追加（SSO認証、評価結果送信） |
| 2025-01-31 | 1.5 | 面接練習画面を詳細化（HeyGen Avatar統合、画面レイアウト、フロー追加） |
| 2025-01-31 | 1.6 | 面接練習画面のASCII図をDrawIO画像に置き換え |
| 2025-01-31 | 1.7 | 面接予約画面・日程管理画面を削除（スコープ外） |
| 2025-02-01 | 1.8 | 管理者向け画面をmintoku work側で提供に変更（本システムは一般ユーザー向け機能に特化） |
| 2025-02-01 | 1.9 | 基本設計書（15章）に統合 |
| 2025-02-02 | 2.0 | 管理者向け機能を本システムで提供に変更、mintoku workとの連携はSSO認証と評価結果送信のみに限定、エラーハンドリング詳細を追加 |
| 2025-02-03 | 2.1 | 適応型JLPTレベル調整機能を追加: フィードバック画面のレベル調整ボタン、チャレンジ機能、平均スコア表示 |
| 2025-02-03 | 2.2 | 企業向け統合評価レポート対応: 面接練習画面を全画面表示に更新（アバター背景全体表示）、チャレンジ選択UI追加、フィードバック画面に企業向けレポートセクション追加、管理者向け練習内容確認機能追加、mintoku work連携データ拡張 |
| 2025-02-04 | 2.3 | 管理者向けユーザー管理画面を再構成: 6.3.5をAI面談実施ユーザー一覧画面として新設、6.3.6をユーザー詳細分析画面として独立、苦手項目詳細画面・練習履歴詳細画面を追加（DrawIO図作成）、管理者向け画面遷移図を更新、6.3.7にmintoku work連携を移動 |
| 2025-02-04 | 2.4 | データソース・データライフサイクル整合性検証: 各画面の要素表に空状態・エラー状態表示を統合、6.5.7節をmintoku work側のスコープ外として明確化、評価失敗モーダルをDrawIO図化、対応プラットフォームセクションを03_技術スタックに移動 |
| 2025-02-04 | 2.5 | 業界別学習計画機能: ホーム画面の「面接練習の状況カード」を「学習計画進捗カード」に変更、学習計画に対する進捗表示に対応、希望業界連携の反映 |
| 2025-02-04 | 2.6 | mintoku work API連携の整理: API詳細を10_API仕様に集約、画面設計書からJSON定義を削除しAPI仕様書への参照に変更、6.5.5に希望業界を追加 |
