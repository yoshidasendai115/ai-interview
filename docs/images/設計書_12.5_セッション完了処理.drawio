<mxfile host="65bd71144e">
    <diagram name="Session Complete Flow" id="session-complete-flow">
        <mxGraphModel dx="900" dy="700" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>

                <!-- Title -->
                <mxCell id="title" value="セッション完了処理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="300" y="20" width="300" height="40" as="geometry"/>
                </mxCell>

                <!-- Step 1 -->
                <mxCell id="step1" value="1. 最後の質問回答完了" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="80" width="300" height="45" as="geometry"/>
                </mxCell>

                <!-- Arrow 1-2 -->
                <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step1" target="step2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 2 -->
                <mxCell id="step2" value="2. フロントエンド → バックエンド&#xa;PUT /api/v1/sessions/{id}/complete" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="155" width="300" height="50" as="geometry"/>
                </mxCell>

                <!-- Arrow 2-3 -->
                <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step2" target="step3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 3 -->
                <mxCell id="step3" value="3. バックエンド: HeyGenセッション終了" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="235" width="300" height="45" as="geometry"/>
                </mxCell>

                <!-- Arrow 3-4 -->
                <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step3" target="step4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 4 Container -->
                <mxCell id="step4" value="4. バックエンド: 評価処理（非同期）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="310" width="300" height="45" as="geometry"/>
                </mxCell>

                <!-- Parallel Branch Container -->
                <mxCell id="parallel-container" value="" style="rounded=3;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#b85450;strokeWidth=2;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="100" y="380" width="700" height="300" as="geometry"/>
                </mxCell>
                <mxCell id="parallel-label" value="並列処理" style="text;html=1;strokeColor=none;fillColor=#f8d7da;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="110" y="390" width="80" height="20" as="geometry"/>
                </mxCell>

                <!-- Arrow 4-4a -->
                <mxCell id="arrow4a" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="step4" target="step4a" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Arrow 4-4b -->
                <mxCell id="arrow4b" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="step4" target="step4b" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 4a -->
                <mxCell id="step4a" value="4a. 日本語能力評価（GPT-4o）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="130" y="420" width="250" height="40" as="geometry"/>
                </mxCell>

                <!-- Step 4a Details -->
                <mxCell id="step4a-detail1" value="- 各回答の語彙・文法・内容・敬語を評価" style="text;html=1;strokeColor=none;fillColor=#f8d7da;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="130" y="470" width="250" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="step4a-detail2" value="- evaluation_detailsテーブルに保存" style="text;html=1;strokeColor=none;fillColor=#f8d7da;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="130" y="500" width="250" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="step4a-detail3" value="- 詳細: 07_評価ロジック" style="text;html=1;strokeColor=none;fillColor=#fff3cd;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="130" y="530" width="250" height="25" as="geometry"/>
                </mxCell>

                <!-- Step 4b -->
                <mxCell id="step4b" value="4b. 採用適性評価（GPT-4o）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="520" y="420" width="250" height="40" as="geometry"/>
                </mxCell>

                <!-- Step 4b Details -->
                <mxCell id="step4b-detail1" value="- 適応力・コミュニケーション力・&#xa;  主体性・定着意向・協調性を評価" style="text;html=1;strokeColor=none;fillColor=#f8d7da;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="520" y="470" width="250" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="step4b-detail2" value="- aptitude_evaluationsテーブルに保存" style="text;html=1;strokeColor=none;fillColor=#f8d7da;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="520" y="515" width="250" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="step4b-detail3" value="- 詳細: 13_面接シナリオ設計" style="text;html=1;strokeColor=none;fillColor=#fff3cd;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="520" y="545" width="250" height="25" as="geometry"/>
                </mxCell>

                <!-- Merge Point -->
                <mxCell id="merge" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="430" y="610" width="40" height="40" as="geometry"/>
                </mxCell>

                <!-- Arrow 4a to merge -->
                <mxCell id="arrow4a-merge" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step4a-detail3" target="merge" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Arrow 4b to merge -->
                <mxCell id="arrow4b-merge" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step4b-detail3" target="merge" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Arrow merge-5 -->
                <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="merge" target="step5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 5 -->
                <mxCell id="step5" value="5. 両評価を統合&#xa;→ evaluationsテーブルに総合スコアを保存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="710" width="300" height="50" as="geometry"/>
                </mxCell>

                <!-- Arrow 5-6 -->
                <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step5" target="step6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 6 -->
                <mxCell id="step6" value="6. mintoku workへ統合結果を送信" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="790" width="300" height="45" as="geometry"/>
                </mxCell>

                <!-- Arrow 6-7 -->
                <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;" parent="1" source="step6" target="step7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <!-- Step 7 -->
                <mxCell id="step7" value="7. フロントエンド: フィードバック画面へ遷移" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="300" y="865" width="300" height="45" as="geometry"/>
                </mxCell>

                <!-- Legend -->
                <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="650" y="80" width="200" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="legend-title" value="凡例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="660" y="85" width="40" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="660" y="110" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg1-text" value="ユーザー/フロント" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="107" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="660" y="135" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg2-text" value="バックエンド処理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="132" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="660" y="160" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg3-text" value="HeyGen" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="157" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
                    <mxGeometry x="660" y="185" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg4-text" value="GPT-4o評価" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="182" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="660" y="210" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg5-text" value="外部連携" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="207" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="leg6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="660" y="235" width="15" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="leg6-text" value="結合ポイント" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="680" y="232" width="80" height="20" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
