<mxfile host="app.diagrams.net" modified="2026-02-05T00:00:00.000Z" agent="Claude" version="21.0.0">
  <diagram name="12.2 セッション開始シーケンス" id="session-start">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="700" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- タイトル -->
        <mxCell id="title" value="12.2 セッション開始シーケンス" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="300" height="30" as="geometry"/>
        </mxCell>

        <!-- ステップ1 -->
        <mxCell id="step1" value="1. ユーザーが「面接を始める」をタップ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="300" y="70" width="280" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="110" as="sourcePoint"/>
            <mxPoint x="440" y="140" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ2 -->
        <mxCell id="step2" value="2. フロントエンド → バックエンド&#xa;POST /api/v1/sessions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="300" y="140" width="280" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="185" as="sourcePoint"/>
            <mxPoint x="440" y="215" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ3 -->
        <mxCell id="step3" value="3. バックエンド: 質問バンクから&#xa;業界×JLPTレベルで質問選択、セッション作成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="300" y="215" width="280" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="260" as="sourcePoint"/>
            <mxPoint x="440" y="290" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ4 -->
        <mxCell id="step4" value="4. バックエンド → HeyGen API&#xa;createStreamingSession()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontColor=#6A1B9A;" vertex="1" parent="1">
          <mxGeometry x="300" y="290" width="280" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="arrow4" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="335" as="sourcePoint"/>
            <mxPoint x="440" y="365" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ5 -->
        <mxCell id="step5" value="5. HeyGen: WebRTCセッション確立&#xa;session_token返却" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontColor=#6A1B9A;" vertex="1" parent="1">
          <mxGeometry x="300" y="365" width="280" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="arrow5" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="410" as="sourcePoint"/>
            <mxPoint x="440" y="440" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ6 -->
        <mxCell id="step6" value="6. バックエンド → フロントエンド&#xa;セッション情報 + HeyGenトークン" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="300" y="440" width="280" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="arrow6" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="485" as="sourcePoint"/>
            <mxPoint x="440" y="515" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ7 -->
        <mxCell id="step7" value="7. フロントエンド: HeyGen SDKでアバター接続" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="300" y="515" width="280" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="arrow7" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="555" as="sourcePoint"/>
            <mxPoint x="440" y="585" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ8 -->
        <mxCell id="step8" value="8. アバター接続完了 → 面接開始" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="585" width="280" height="40" as="geometry"/>
        </mxCell>

        <!-- 凡例 -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#E0E0E0;" vertex="1" parent="1">
          <mxGeometry x="680" y="70" width="200" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="legend-title" value="凡例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="75" width="50" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-fe" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="690" y="100" width="20" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-fe-text" value="フロントエンド" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="715" y="97" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-be" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;" vertex="1" parent="1">
          <mxGeometry x="690" y="120" width="20" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-be-text" value="バックエンド" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="715" y="117" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-db" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;" vertex="1" parent="1">
          <mxGeometry x="690" y="140" width="20" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-db-text" value="DB処理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="715" y="137" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-ext" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="690" y="160" width="20" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-ext-text" value="外部API" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="715" y="157" width="80" height="20" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="12.5 音声入力フロー" id="audio-input">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="600" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- タイトル -->
        <mxCell id="title2" value="12.5 音声入力フロー（Google Cloud STT統合）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="400" height="30" as="geometry"/>
        </mxCell>

        <!-- ステップ1 -->
        <mxCell id="a1" value="1. マイクボタンタップ&#xa;MediaRecorder開始" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="350" y="70" width="200" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="ar1" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="115" as="sourcePoint"/>
            <mxPoint x="450" y="145" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ2 -->
        <mxCell id="a2" value="2. 音声データをWebSocketで&#xa;バックエンドに送信" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="350" y="145" width="200" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="ar2" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="190" as="sourcePoint"/>
            <mxPoint x="450" y="220" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ3 -->
        <mxCell id="a3" value="3. バックエンド → Google Cloud STT&#xa;（Streaming API）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontColor=#6A1B9A;" vertex="1" parent="1">
          <mxGeometry x="350" y="220" width="200" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="ar3" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="265" as="sourcePoint"/>
            <mxPoint x="450" y="295" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ4 -->
        <mxCell id="a4" value="4. 中間結果をリアルタイムで&#xa;フロントエンドに返却" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="350" y="295" width="200" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="ar4" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="340" as="sourcePoint"/>
            <mxPoint x="450" y="370" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ5 -->
        <mxCell id="a5" value="5. 最終結果確定&#xa;→ 回答テキストとして保存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="350" y="370" width="200" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="ar5" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="415" as="sourcePoint"/>
            <mxPoint x="450" y="445" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ6 -->
        <mxCell id="a6" value="6. 5秒間無音検出 → 自動停止" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#D32F2F;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="350" y="445" width="200" height="40" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="12.6 セッション完了処理" id="session-complete">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- タイトル -->
        <mxCell id="title3" value="12.6 セッション完了処理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="300" height="30" as="geometry"/>
        </mxCell>

        <!-- ステップ1 -->
        <mxCell id="c1" value="1. 最後の質問回答完了" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="450" y="70" width="250" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="cr1" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="110" as="sourcePoint"/>
            <mxPoint x="575" y="140" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ2 -->
        <mxCell id="c2" value="2. フロントエンド → バックエンド&#xa;PUT /api/v1/sessions/{id}/complete" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="450" y="140" width="250" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="cr2" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="185" as="sourcePoint"/>
            <mxPoint x="575" y="215" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ3 -->
        <mxCell id="c3" value="3. バックエンド: HeyGenセッション終了" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontColor=#6A1B9A;" vertex="1" parent="1">
          <mxGeometry x="450" y="215" width="250" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="cr3" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="255" as="sourcePoint"/>
            <mxPoint x="575" y="285" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ4（並列処理） -->
        <mxCell id="c4-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#FBC02D;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="285" width="600" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="c4-title" value="4. バックエンド: 評価処理（非同期・並列）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1;fontSize=11;fontColor=#F57F17;" vertex="1" parent="1">
          <mxGeometry x="290" y="290" width="280" height="20" as="geometry"/>
        </mxCell>

        <!-- 4a -->
        <mxCell id="c4a" value="4a. 日本語能力評価（GPT-4o）&#xa;- 語彙・文法・内容・敬語を評価&#xa;- evaluation_detailsに保存&#xa;- 詳細: 07_評価ロジック" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="300" y="320" width="250" height="80" as="geometry"/>
        </mxCell>

        <!-- 4b -->
        <mxCell id="c4b" value="4b. 採用適性評価（GPT-4o）&#xa;- 適応力・コミュ力・主体性等を評価&#xa;- aptitude_evaluationsに保存&#xa;- 詳細: 13_面接シナリオ設計" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#E91E63;fontColor=#C2185B;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="610" y="320" width="250" height="80" as="geometry"/>
        </mxCell>

        <!-- 並列矢印 -->
        <mxCell id="cr4" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="445" as="sourcePoint"/>
            <mxPoint x="575" y="475" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ5 -->
        <mxCell id="c5" value="5. 両評価を統合&#xa;→ evaluationsテーブルに総合スコア保存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="450" y="475" width="250" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="cr5" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="520" as="sourcePoint"/>
            <mxPoint x="575" y="550" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ6 -->
        <mxCell id="c6" value="6. mintoku workへ統合結果を送信" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;fontColor=#6A1B9A;" vertex="1" parent="1">
          <mxGeometry x="450" y="550" width="250" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="cr6" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="590" as="sourcePoint"/>
            <mxPoint x="575" y="620" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ7 -->
        <mxCell id="c7" value="7. フロントエンド: フィードバック画面へ遷移" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="620" width="250" height="40" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="12.9 レベル調整フロー" id="level-adjustment">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="700" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- タイトル -->
        <mxCell id="title4" value="12.9.2 適応型JLPTレベル調整フロー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="300" height="30" as="geometry"/>
        </mxCell>

        <!-- ステップ1 -->
        <mxCell id="l1" value="1. 面接セッション完了" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="375" y="70" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="lr1" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="110" as="sourcePoint"/>
            <mxPoint x="475" y="140" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ2 -->
        <mxCell id="l2" value="2. 評価スコア算出（0-100点）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="375" y="140" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="lr2" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="180" as="sourcePoint"/>
            <mxPoint x="475" y="210" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ3（分岐） -->
        <mxCell id="l3" value="3. スコア判定" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#FBC02D;fontColor=#F57F17;" vertex="1" parent="1">
          <mxGeometry x="415" y="210" width="120" height="80" as="geometry"/>
        </mxCell>

        <!-- 分岐: 70点以上 -->
        <mxCell id="l3a" value="70点以上&#xa;レベルアップ推奨" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;" vertex="1" parent="1">
          <mxGeometry x="180" y="320" width="150" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="lr3a" value="" style="endArrow=classic;html=1;strokeColor=#388E3C;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="415" y="250" as="sourcePoint"/>
            <mxPoint x="255" y="320" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="255" y="250"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 分岐: 31-69点 -->
        <mxCell id="l3b" value="31〜69点&#xa;同レベル継続&#xa;（上位挑戦オプションあり）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="400" y="320" width="150" height="55" as="geometry"/>
        </mxCell>
        <mxCell id="lr3b" value="" style="endArrow=classic;html=1;strokeColor=#FB8C00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="290" as="sourcePoint"/>
            <mxPoint x="475" y="320" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- 分岐: 30点以下 -->
        <mxCell id="l3c" value="30点以下&#xa;レベルダウン推奨" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#D32F2F;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="620" y="320" width="150" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="lr3c" value="" style="endArrow=classic;html=1;strokeColor=#D32F2F;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="535" y="250" as="sourcePoint"/>
            <mxPoint x="695" y="320" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="695" y="250"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 収束 -->
        <mxCell id="lr4a" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="255" y="365" as="sourcePoint"/>
            <mxPoint x="475" y="420" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="255" y="420"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lr4b" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="375" as="sourcePoint"/>
            <mxPoint x="475" y="420" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="lr4c" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="695" y="365" as="sourcePoint"/>
            <mxPoint x="475" y="420" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="695" y="420"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ステップ4 -->
        <mxCell id="l4" value="4. フィードバック画面でボタン表示" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="375" y="420" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="lr5" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="460" as="sourcePoint"/>
            <mxPoint x="475" y="490" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ5 -->
        <mxCell id="l5" value="5. ユーザー選択 or 自動遷移" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="375" y="490" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="lr6" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="530" as="sourcePoint"/>
            <mxPoint x="475" y="560" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- ステップ6 -->
        <mxCell id="l6" value="6. 次回セッションのJLPTレベル決定" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="375" y="560" width="200" height="40" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="12.10.3 学習計画存在判定" id="learning-plan-check">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- タイトル -->
        <mxCell id="title5" value="12.10.3 学習計画存在判定ロジック" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="300" height="30" as="geometry"/>
        </mxCell>

        <!-- 開始 -->
        <mxCell id="p1" value="認証コールバック処理開始&#xa;（業界情報同期完了後）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="475" y="70" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr1" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="120" as="sourcePoint"/>
            <mxPoint x="575" y="150" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- DB検索 -->
        <mxCell id="p2" value="SELECT * FROM learning_plans&#xa;WHERE user_id = ? AND status = 'active'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FB8C00;fontColor=#E65100;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="450" y="150" width="250" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr2" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="575" y="200" as="sourcePoint"/>
            <mxPoint x="575" y="230" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- レコード数判定 -->
        <mxCell id="p3" value="レコード数" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#FBC02D;fontColor=#F57F17;" vertex="1" parent="1">
          <mxGeometry x="515" y="230" width="120" height="80" as="geometry"/>
        </mxCell>

        <!-- 0件: 新規作成 -->
        <mxCell id="p4a" value="新規作成&#xa;（12.10.4へ）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;" vertex="1" parent="1">
          <mxGeometry x="280" y="350" width="120" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr3a" value="0件" style="endArrow=classic;html=1;strokeColor=#388E3C;strokeWidth=2;fontColor=#388E3C;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="515" y="270" as="sourcePoint"/>
            <mxPoint x="340" y="350" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="340" y="270"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 1件: 業界変更チェック -->
        <mxCell id="p4b" value="業界変更チェック" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="720" y="350" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="pr3b" value="1件" style="endArrow=classic;html=1;strokeColor=#1565C0;strokeWidth=2;fontColor=#1565C0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="635" y="270" as="sourcePoint"/>
            <mxPoint x="790" y="350" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="790" y="270"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 比較ボックス -->
        <mxCell id="p5" value="既存: plan.industry_id&#xa;新規: preferred_industry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#9E9E9E;fontColor=#616161;" vertex="1" parent="1">
          <mxGeometry x="710" y="420" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr4" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="790" y="390" as="sourcePoint"/>
            <mxPoint x="790" y="420" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- 業界判定 -->
        <mxCell id="p6" value="業界" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#FBC02D;fontColor=#F57F17;" vertex="1" parent="1">
          <mxGeometry x="740" y="500" width="100" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="pr5" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="790" y="470" as="sourcePoint"/>
            <mxPoint x="790" y="500" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- 同じ: 何もしない -->
        <mxCell id="p7a" value="何もしない&#xa;（継続）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#43A047;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="600" y="610" width="100" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr6a" value="同じ" style="endArrow=classic;html=1;strokeColor=#43A047;strokeWidth=2;fontColor=#43A047;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="740" y="535" as="sourcePoint"/>
            <mxPoint x="650" y="610" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="650" y="535"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 異なる: archived + 新規作成 -->
        <mxCell id="p7b" value="既存 → archived&#xa;新規作成（12.10.4へ）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#E91E63;fontColor=#C2185B;" vertex="1" parent="1">
          <mxGeometry x="860" y="610" width="150" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="pr6b" value="異なる" style="endArrow=classic;html=1;strokeColor=#E91E63;strokeWidth=2;fontColor=#E91E63;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="840" y="535" as="sourcePoint"/>
            <mxPoint x="935" y="610" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="935" y="535"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 収束 -->
        <mxCell id="pr7a" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="340" y="400" as="sourcePoint"/>
            <mxPoint x="575" y="720" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="340" y="720"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pr7b" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="650" y="660" as="sourcePoint"/>
            <mxPoint x="575" y="720" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="650" y="720"/>
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pr7c" value="" style="endArrow=classic;html=1;strokeColor=#616161;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="935" y="660" as="sourcePoint"/>
            <mxPoint x="575" y="720" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="935" y="720"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 終了 -->
        <mxCell id="p8" value="ホーム画面へ遷移" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontColor=#1B5E20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="720" width="150" height="40" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
